graph TB
    %% –°—Ç–∏–ª–∏
    classDef frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    classDef backend fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000
    classDef database fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef cache fill:#fff3e0,stroke:#ff9800,stroke-width:2px,color:#000
    classDef api fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000

    %% –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    USERS[üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏<br/>–í–µ–±-–±—Ä–∞—É–∑–µ—Ä]

    %% Frontend Layer
    subgraph FRONTEND ["üé® Frontend Layer (React)"]
        SIGNIN[SignIn Component<br/>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è]
        SIGNUP[SignUp Component<br/>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è]
        CHATLIST[ChatList Component<br/>–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤]
        CHAT[Chat Component<br/>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞]
        WEBSOCKET_CLIENT[WebSocket Client<br/>Socket.IO]
    end

    %% Backend Layer
    subgraph BACKEND ["‚öôÔ∏è Backend Layer (Node.js/Express)"]
        subgraph ROUTES ["üõ£Ô∏è API Routes"]
            USER_ROUTER[User Router<br/>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏]
            CHAT_ROUTER[Chat Router<br/>–ß–∞—Ç—ã]
            MESSAGE_ROUTER[Message Router<br/>–°–æ–æ–±—â–µ–Ω–∏—è]
            FILE_ROUTER[File Router<br/>–§–∞–π–ª—ã]
        end
        
        subgraph CONTROLLERS ["üéÆ Controllers"]
            USER_CTRL[User Controller<br/>–õ–æ–≥–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π]
            CHAT_CTRL[Chat Controller<br/>–õ–æ–≥–∏–∫–∞ —á–∞—Ç–æ–≤]
            MESSAGE_CTRL[Message Controller<br/>–õ–æ–≥–∏–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π]
        end
        
        subgraph MIDDLEWARE ["üîí Middleware"]
            AUTH_MW[Auth Middleware<br/>JWT –ø—Ä–æ–≤–µ—Ä–∫–∞]
            ERROR_MW[Error Middleware<br/>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫]
            TOKEN_SERVICE[Token Service<br/>JWT —Ç–æ–∫–µ–Ω—ã]
        end
        
        subgraph SOCKET ["üîå WebSocket Layer"]
            SOCKET_SERVER[Socket.IO Server<br/>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è]
            MESSAGE_HANDLER[Message Handler<br/>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π]
            USER_STATUS[User Status<br/>–°—Ç–∞—Ç—É—Å—ã –æ–Ω–ª–∞–π–Ω]
        end
    end

    %% Data Layer
    subgraph DATA ["üíæ Data Layer"]
        subgraph MODELS ["üìã Data Models (Sequelize ORM)"]
            USER_MODEL[User Model<br/>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏]
            CHAT_MODEL[Chat Model<br/>–ß–∞—Ç—ã]
            MESSAGE_MODEL[Message Model<br/>–°–æ–æ–±—â–µ–Ω–∏—è]
            FRIENDSHIP_MODEL[Friendship Model<br/>–î—Ä—É–∂–±–∞]
            FILE_MODEL[File Model<br/>–§–∞–π–ª—ã]
        end
        
        POSTGRES[(PostgreSQL<br/>–û—Å–Ω–æ–≤–Ω–∞—è –ë–î<br/>:5432)]
        REDIS[(Redis Cache<br/>–°–µ—Å—Å–∏–∏ –∏ –∫—ç—à<br/>:6379)]
    end

    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
    USERS -->|HTTP/HTTPS| SIGNIN
    USERS -->|HTTP/HTTPS| SIGNUP
    USERS -->|HTTP/HTTPS| CHATLIST
    USERS -->|HTTP/HTTPS| CHAT
    USERS <-->|WebSocket| WEBSOCKET_CLIENT

    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å –±—ç–∫–µ–Ω–¥–æ–º
    SIGNIN -->|POST /api/auth/login| USER_ROUTER
    SIGNUP -->|POST /api/auth/register| USER_ROUTER
    CHATLIST -->|GET /api/chats| CHAT_ROUTER
    CHAT -->|GET /api/messages| MESSAGE_ROUTER
    CHAT -->|POST /api/messages| MESSAGE_ROUTER
    WEBSOCKET_CLIENT <-->|Socket.IO| SOCKET_SERVER

    %% –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–≤—è–∑–∏ –±—ç–∫–µ–Ω–¥–∞
    USER_ROUTER --> USER_CTRL
    CHAT_ROUTER --> CHAT_CTRL
    MESSAGE_ROUTER --> MESSAGE_CTRL
    FILE_ROUTER --> MESSAGE_CTRL

    %% Middleware –æ–±—Ä–∞–±–æ—Ç–∫–∞
    USER_ROUTER -.-> AUTH_MW
    CHAT_ROUTER -.-> AUTH_MW
    MESSAGE_ROUTER -.-> AUTH_MW
    AUTH_MW --> TOKEN_SERVICE
    
    %% Error handling
    USER_CTRL -.-> ERROR_MW
    CHAT_CTRL -.-> ERROR_MW
    MESSAGE_CTRL -.-> ERROR_MW

    %% WebSocket –æ–±—Ä–∞–±–æ—Ç–∫–∞
    SOCKET_SERVER --> MESSAGE_HANDLER
    SOCKET_SERVER --> USER_STATUS
    MESSAGE_HANDLER --> MESSAGE_CTRL

    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö
    USER_CTRL <--> USER_MODEL
    CHAT_CTRL <--> CHAT_MODEL
    CHAT_CTRL <--> USER_MODEL
    MESSAGE_CTRL <--> MESSAGE_MODEL
    MESSAGE_CTRL <--> FILE_MODEL
    MESSAGE_CTRL <--> CHAT_MODEL
    USER_STATUS <--> USER_MODEL

    %% –°–≤—è–∑–∏ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
    USER_MODEL -.->|Many-to-Many| CHAT_MODEL
    CHAT_MODEL -.->|One-to-Many| MESSAGE_MODEL
    MESSAGE_MODEL -.->|Many-to-Many| FILE_MODEL
    USER_MODEL -.->|One-to-Many| FRIENDSHIP_MODEL

    %% –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
    USER_MODEL <-->|SQL –∑–∞–ø—Ä–æ—Å—ã| POSTGRES
    CHAT_MODEL <-->|SQL –∑–∞–ø—Ä–æ—Å—ã| POSTGRES
    MESSAGE_MODEL <-->|SQL –∑–∞–ø—Ä–æ—Å—ã| POSTGRES
    FRIENDSHIP_MODEL <-->|SQL –∑–∞–ø—Ä–æ—Å—ã| POSTGRES
    FILE_MODEL <-->|SQL –∑–∞–ø—Ä–æ—Å—ã| POSTGRES

    %% –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    USER_STATUS <-->|–°—Ç–∞—Ç—É—Å—ã –æ–Ω–ª–∞–π–Ω| REDIS
    TOKEN_SERVICE <-->|JWT —Ç–æ–∫–µ–Ω—ã| REDIS
    MESSAGE_HANDLER <-->|–í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ| REDIS

    %% –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π
    class SIGNIN,SIGNUP,CHATLIST,CHAT,WEBSOCKET_CLIENT frontend
    class USER_ROUTER,CHAT_ROUTER,MESSAGE_ROUTER,FILE_ROUTER,USER_CTRL,CHAT_CTRL,MESSAGE_CTRL,SOCKET_SERVER,MESSAGE_HANDLER,USER_STATUS api
    class AUTH_MW,ERROR_MW,TOKEN_SERVICE backend
    class USER_MODEL,CHAT_MODEL,MESSAGE_MODEL,FRIENDSHIP_MODEL,FILE_MODEL,POSTGRES database
    class REDIS cache